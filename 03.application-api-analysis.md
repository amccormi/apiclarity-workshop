# 03. Application API analysis

Now, let's install the user application bookinfo.

The application displays information about a book, similar to a single catalog entry of an online book store. Displayed on the page is a description of the book, book details (ISBN, number of pages, and so on), and a few book reviews.

The Bookinfo application is broken into four separate microservices:

* productpage. The productpage microservice calls the details and reviews microservices to populate the page.
* details. The details microservice contains book information.
* reviews. The reviews microservice contains book reviews. It also calls the ratings microservice.
* ratings. The ratings microservice contains book ranking information that accompanies a book review.

There are 3 versions of the reviews microservice:

* Version v1 doesnâ€™t call the ratings service.
* Version v2 calls the ratings service, and displays each rating as 1 to 5 black stars.
* Version v3 calls the ratings service, and displays each rating as 1 to 5 red stars.

The end-to-end architecture of the application is shown below.

![](images/booinfo-istio.svg)

As the application architecture is based on micro-services which use REST APIs for inter communication,
APIClarity can analyse it.

[Locust](https://docs.locust.io/en/stable/#) is deployed as part of the application to simulate periodic user requests.

## Task 1. Deploy BookInfo Application

Run the following command to install the BookInfo application:

```bash
kubectl apply -f $HOME/lab/bookinfo/bookinfo.yaml --namespace=bookinfo
```

You should have a similar output:

```console
service/details created
serviceaccount/bookinfo-details created
deployment.apps/details-v1 created
service/ratings created
serviceaccount/bookinfo-ratings created
deployment.apps/ratings-v1 created
service/reviews created
serviceaccount/bookinfo-reviews created
deployment.apps/reviews-v1 created
deployment.apps/reviews-v2 created
deployment.apps/reviews-v3 created
service/productpage created
serviceaccount/bookinfo-productpage created
deployment.apps/productpage-v1 created
configmap/reviews-inject-config created
deployment.apps/reviews-inject-v1 created
```

## Task 2. Analyse API traffic on APIClarity

Open the web UI of APIClarity. Refresh the page if you don't find captured traffic.

Observe the graph. Multiple user requests are automcatically simulated. This generates several hundreds of API calls every second. None of the detected calls are known by APIClarity. Thus, they are defined as *New APIs*.

![](./images/2022-10-26-14-26-51.png)

## Task 3. Reconstruct API schema.

Under the API inventory you will find three discovered APIs:

* reviews.bookinfo
* ratings.bookinfo
* details.bookinfo

![](./images/2022-10-26-14-30-47.png)

Use APIClarity's capability to reconstruct an OpenAPI schema based on the captured traffic.
Reconstruct the schema for the three APIs.


![](./images/2022-10-26-14-28-45.png)


Click all paths and approve review.

![](./images/2022-10-26-14-32-48.png)

Choose OAS V3

![](./images/2022-10-26-14-33-34.png)

Once the schema is generated, you can review it in Swagger.

![](./images/2022-10-26-14-34-23.png)

## Task 4. Analysis of API difference

Once a schema is loaded by the user or reconstructed by APIClarity, the application is using to compare running traffic towards the blueprint.

Use the API Events page to find for traffic which does not respect the schema:

![](./images/2022-10-26-14-37-23.png)

Review an event with alert.

![](./images/2022-10-26-14-37-52.png)

You will find that this particular API call does not respect the generated schema - several parameters are missing.